<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Weather Dashboard</title>
    <!-- Bootstrap CSS CDN  -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
    <!-- local style sheet -->
    <link rel="stylesheet" href="./style.css/>">
    <!-- jQuery & AJAX -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
</head>

<body class="container container-md">
    <header class="row">
        <h1 class="well well-lg col">Weather Dashboard</h1>
    </header>

    <body>
        <!-- Display search box, submit icon, for user input form to get city -->
        <form id="city-form">
            <!-- Label for Text Box -->
            <label for="city-input">Search for a City</label>

            <!-- Text Input Box -->
            <input type="text" id="city-input"><br>

            <!-- Submit Button -->
            <input id="submitted-city" type="submit" value="Submit">
            <!--this should be a search icon -->
        </form>

        <!-- HtmL framework for data from APIs -->
        <div class="city"></div>
        <div class="temp"></div>
        <div class="humidity"></div>
        <div class="wind"></div>
        <div class="uvindex"></div>
        <div class="forecast"></div>

        <script type="text/javascript">

            $(document).ready(function () {

                // event listener on the Submti button
                $("#submitted-city").on("click", function (event) {
                    // Preventing the button from trying to submit the form
                    event.preventDefault();

                    // Storing the submitted city name
                    var subCity = $("#city-input").val().trim();

                    // OpenWeather API key
                    var APIKey = "7321de3bce923134cdfb94c3f0188e62";

                    // OpenWeather query for current weather with user imput and api key
                    var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + subCity + "&units=imperial&appid=" + APIKey

                    //declare and define date variables
                    var longDate = new Date();
                    console.log(longDate);
                    var dd = longDate.getDate();
                    var mm = longDate.getMonth() + 1;
                    var yyyy = longDate.getFullYear();
                    console.log(mm, dd, yyyy);

                    //call functions for current weather and the five-day forecast
                    getCurrentWeather(queryURL, dd, mm, yyyy);
                    getForecast(subCity, APIKey, dd, mm, yyyy);
                });

                //gets and renders current weather
                function getCurrentWeather(queryURL, dd, mm, yyyy) {
                    // Call to OpenWeather server for current weather data, render city, today's date, weather icon
                    $.ajax({
                        url: queryURL,
                        method: "GET"
                    })
                        // We store all of the retrieved data inside of an object called "response"
                        .then(function (response) {

                            // Log the resulting object for reference
                            console.log(response);
                            var lat = response.coord.lat;
                            var lon = response.coord.lon;
                            console.log(lat, lon);

                            //Retrieve the weather icon
                            var icon = ("<img src='http://openweathermap.org/img/w/" + response.weather[0].icon + ".png'>");

                            //Render City and Weather Icon
                            $(".city").append("<span>" + response.name + "</span>");
                            $(".city").append("<span>" + icon + "</span>");

                            // Render Temp, Wind Speed, Humidity and UV content to HTML
                            $(".temp").text("Temperature: " + response.main.temp + " degrees");   //add degress symbol
                            $(".wind").text("Wind Speed: " + response.wind.speed + " mph");
                            $(".humidity").text("Humidity: " + response.main.humidity + "%");
                            getCurrentUV(lat, lon);
                        });
                    if (dd < 10) {
                        dd = '0' + dd;
                    }
                    if (mm < 10) {
                        mm = '0' + mm;
                    }
                    var today = mm + '/' + dd + '/' + yyyy;
                    $(".city").append("<span>" + today + "</span>");
                };

                function getCurrentUV(lat, lon) {
                    console.log(lat, lon);
                    // Call to OpenWeather server for current weather data, render city, today's date, weather icon
                    $.ajax({
                        url: "http://api.openweathermap.org/data/2.5/uvi?appid=7321de3bce923134cdfb94c3f0188e62&lat=" + lat + "&lon=" + lon,
                        method: "GET"
                    })
                        // We store all of the retrieved data inside of an object called "response"
                        .then(function (response) {

                            // Log the resulting object for reference
                            console.log(response);

                            // Transfer content to HTML
                            $(".uvindex").text("UV Index:  " + response.value);
                        });
                };

                // gets and displays the five-day forecast
                function getForecast(subCity, APIKey, dd, mm, yyyy) {
                    var forecastUrl = "https://api.openweathermap.org/data/2.5/forecast";

                    $.ajax({
                        url: forecastUrl, //API Call
                        type: "GET",
                        data: {
                            q: subCity,
                            appid: APIKey,
                            units: "imperial",
                        },
                        success: function (response) {
                            console.log('Received data:', response) // For testing
                            console.log(response.city.name);
                            for (var i = 0; i < 5; i++) {
                                var placeHolder = response.list[i].main;
                                dd = dd + 1;
                                if (dd < 10) {
                                    dd = '0' + dd;
                                }
                                var forecastDate = mm + '/' + dd + '/' + yyyy;
                                var high = placeHolder.temp_max;
                                var humidity = placeHolder.humidity;
                                var icon = "<img src='https://openweathermap.org/img/w/" + response.list[i].weather[0].icon + ".png'>"
                                $(".forecast").append(forecastDate);
                                $(".forecast").append("<p>" + icon + "</p>");
                                $(".forecast").append("<p>" + "Temperature: " + high + "</p>");   //add degress symbol
                                $(".forecast").append("<p>" + "Humidity: " + humidity + "%" + "</p>");
                            }
                        }
                    })
                }
            });
        </script>
        <!-- Thanks to GeeksforGeeks for guidance on the date format- https://www.geeksforgeeks.org/how-to-get-current-formatted-date-dd-mm-yyyy-in-javascript/ -->
        <!-- Code to local JavaScript File -->
        <!-- <script src="./script.js"></script> -->
    </body>

</html>